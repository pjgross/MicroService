<!DOCTYPE html>
<html>
    <head>
        <title>Peter gross : 2) Data stored in each service</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">Peter gross</a></span>
                            </li>
                                                    <li>
                                <span><a href="MicroService-Learning-Journey---Story-so-far_956991180.html">MicroService Learning Journey - Story so far</a></span>
                            </li>
                                                    <li>
                                <span><a href="960542706.html">3) Design Considerations</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            Peter gross : 2) Data stored in each service
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
        
    
        
        
            Created by <span class='author'> Peter Gross</span>, last modified on Sep 13, 2020
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <div class="contentLayout2">
<div class="columnLayout three-with-sidebars" data-layout="three-with-sidebars">
<div class="cell sidebars" data-type="sidebars">
<div class="innerCell">
<p style="margin-left: 30.0px;"><br/></p></div>
</div>
<div class="cell normal" data-type="normal">
<div class="innerCell">
<h2 id="id-2)Datastoredineachservice-Eachservicemayusedifferentdatabases">Each service may use different databases</h2><p style="margin-left: 30.0px;">One advantage of having the data stored locally is that each service can use the datastore most applicable for the situation.</p><p style="margin-left: 30.0px;"><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="400" src="attachments/960542708/960543778.png" data-image-src="attachments/960542708/960543778.png" data-unresolved-comment-count="0" data-linked-resource-id="960543778" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image2020-9-7_12-6-54.png" data-base-url="https://confluence.tuigroup.com" data-linked-resource-content-type="image/png" data-linked-resource-container-id="960542708" data-linked-resource-container-version="4"></span></p><p style="margin-left: 30.0px;">In this exercise we will be using MongoDB for simplicity sake, but we could have changed for each service</p><h2 id="id-2)Datastoredineachservice-DataDuplication">Data Duplication</h2><p style="margin-left: 30.0px;">The aim of this exercise is to create services that can be deployed and replaced independently of each other.</p><p style="margin-left: 30.0px;">This means that each service needs all of the data it needs to work without relying on other services, which means data duplication across the services.</p><p style="margin-left: 30.0px;">For example the ticket service data looks like this</p><div class="table-wrap"><table style="margin-left: 30.0px;" class="confluenceTable"><colgroup><col/><col/><col/><col/><col/></colgroup><thead style="margin-left: 30.0px;"><tr style="margin-left: 60.0px;"><th colspan="1" style="text-align: left;" class="confluenceTh"><p style="margin-left: 30.0px;">Table</p></th><th style="text-align: left;" class="confluenceTh"><p style="margin-left: 30.0px;">Field</p></th><th style="text-align: left;" class="confluenceTh"><p style="margin-left: 30.0px;">Type</p></th><th style="text-align: left;" class="confluenceTh"><p style="margin-left: 30.0px;">Required</p></th><th colspan="1" style="text-align: left;" class="confluenceTh"><p style="margin-left: 30.0px;">Owned by</p></th></tr></thead><tbody style="margin-left: 60.0px;"><tr style="margin-left: 60.0px;"><td class="highlight-green confluenceTd" colspan="1" data-highlight-colour="green" style="text-align: left;">Ticket</td><td class="highlight-green confluenceTd" colspan="1" data-highlight-colour="green" style="text-align: left;">id</td><td class="highlight-green confluenceTd" colspan="1" data-highlight-colour="green" style="text-align: left;">String</td><td class="highlight-green confluenceTd" colspan="1" data-highlight-colour="green" style="text-align: left;">true</td><td class="highlight-green confluenceTd" colspan="1" data-highlight-colour="green" style="text-align: left;">tickets</td></tr><tr style="margin-left: 60.0px;"><td class="highlight-green confluenceTd" colspan="1" data-highlight-colour="green" style="text-align: left;">Ticket</td><td class="highlight-green confluenceTd" data-highlight-colour="green" style="text-align: left;">title</td><td class="highlight-green confluenceTd" data-highlight-colour="green" style="text-align: left;">String</td><td class="highlight-green confluenceTd" data-highlight-colour="green" style="text-align: left;">true</td><td class="highlight-green confluenceTd" colspan="1" data-highlight-colour="green" style="text-align: left;">tickets</td></tr><tr style="margin-left: 60.0px;"><td class="highlight-green confluenceTd" colspan="1" data-highlight-colour="green" style="text-align: left;">Ticket</td><td class="highlight-green confluenceTd" data-highlight-colour="green" style="text-align: left;">price</td><td class="highlight-green confluenceTd" data-highlight-colour="green" style="text-align: left;">Number</td><td class="highlight-green confluenceTd" data-highlight-colour="green" style="text-align: left;">true</td><td class="highlight-green confluenceTd" colspan="1" data-highlight-colour="green" style="text-align: left;">tickets</td></tr><tr style="margin-left: 60.0px;"><td class="highlight-green confluenceTd" colspan="1" data-highlight-colour="green" style="text-align: left;">Ticket</td><td class="highlight-green confluenceTd" data-highlight-colour="green" style="text-align: left;">userId</td><td class="highlight-green confluenceTd" data-highlight-colour="green" style="text-align: left;">String</td><td class="highlight-green confluenceTd" data-highlight-colour="green" style="text-align: left;">true</td><td class="highlight-green confluenceTd" colspan="1" data-highlight-colour="green" style="text-align: left;">tickets</td></tr><tr style="margin-left: 60.0px;"><td class="highlight-green confluenceTd" colspan="1" data-highlight-colour="green" style="text-align: left;">Ticket</td><td class="highlight-green confluenceTd" colspan="1" data-highlight-colour="green" style="text-align: left;">version</td><td class="highlight-green confluenceTd" colspan="1" data-highlight-colour="green" style="text-align: left;">Number</td><td class="highlight-green confluenceTd" colspan="1" data-highlight-colour="green" style="text-align: left;">true</td><td class="highlight-green confluenceTd" colspan="1" data-highlight-colour="green" style="text-align: left;">tickets</td></tr><tr style="margin-left: 60.0px;"><td class="highlight-yellow confluenceTd" colspan="1" data-highlight-colour="yellow" style="text-align: left;">Ticket</td><td class="highlight-yellow confluenceTd" colspan="1" data-highlight-colour="yellow" style="text-align: left;">orderId</td><td class="highlight-yellow confluenceTd" colspan="1" data-highlight-colour="yellow" style="text-align: left;">String</td><td class="highlight-yellow confluenceTd" colspan="1" data-highlight-colour="yellow" style="text-align: left;">false</td><td class="highlight-yellow confluenceTd" colspan="1" data-highlight-colour="yellow" style="text-align: left;">orders</td></tr></tbody></table></div><p class="auto-cursor-target" style="margin-left: 30.0px;">The last field is required to work out whether the ticket has been reserved or sold, and we rely on the order service to tell us when this has happened</p><p class="auto-cursor-target" style="margin-left: 30.0px;">The order service data looks like this and has copied data (via events) that it needs from the ticketing service</p><div class="table-wrap"><table style="margin-left: 30.0px;" class="confluenceTable"><colgroup><col/><col/><col/><col/><col/></colgroup><thead style="margin-left: 60.0px;"><tr style="margin-left: 90.0px;"><th colspan="1" style="text-align: left;" class="confluenceTh"><p style="margin-left: 30.0px;">Table</p></th><th style="text-align: left;" class="confluenceTh"><p style="margin-left: 30.0px;">Field</p></th><th style="text-align: left;" class="confluenceTh"><p style="margin-left: 30.0px;">Type</p></th><th style="text-align: left;" class="confluenceTh"><p style="margin-left: 30.0px;">Required</p></th><th colspan="1" style="text-align: left;" class="confluenceTh"><p style="margin-left: 30.0px;">Owned by</p></th></tr></thead><tbody style="margin-left: 90.0px;"><tr style="margin-left: 90.0px;"><td class="highlight-yellow confluenceTd" colspan="1" data-highlight-colour="yellow" style="text-align: left;">Ticket</td><td class="highlight-yellow confluenceTd" colspan="1" data-highlight-colour="yellow" style="text-align: left;">id</td><td class="highlight-yellow confluenceTd" colspan="1" data-highlight-colour="yellow" style="text-align: left;">String</td><td class="highlight-yellow confluenceTd" colspan="1" data-highlight-colour="yellow" style="text-align: left;">true</td><td class="highlight-yellow confluenceTd" colspan="1" data-highlight-colour="yellow" style="text-align: left;">tickets</td></tr><tr style="margin-left: 90.0px;"><td class="highlight-yellow confluenceTd" colspan="1" data-highlight-colour="yellow" style="text-align: left;">Ticket</td><td class="highlight-yellow confluenceTd" data-highlight-colour="yellow" style="text-align: left;">title</td><td class="highlight-yellow confluenceTd" data-highlight-colour="yellow" style="text-align: left;">String</td><td class="highlight-yellow confluenceTd" data-highlight-colour="yellow" style="text-align: left;">true</td><td class="highlight-yellow confluenceTd" colspan="1" data-highlight-colour="yellow" style="text-align: left;">tickets</td></tr><tr style="margin-left: 90.0px;"><td class="highlight-yellow confluenceTd" colspan="1" data-highlight-colour="yellow" style="text-align: left;">Ticket</td><td class="highlight-yellow confluenceTd" data-highlight-colour="yellow" style="text-align: left;">price</td><td class="highlight-yellow confluenceTd" data-highlight-colour="yellow" style="text-align: left;">Number</td><td class="highlight-yellow confluenceTd" data-highlight-colour="yellow" style="text-align: left;">true</td><td class="highlight-yellow confluenceTd" colspan="1" data-highlight-colour="yellow" style="text-align: left;">tickets</td></tr><tr style="margin-left: 90.0px;"><td class="highlight-yellow confluenceTd" colspan="1" data-highlight-colour="yellow" style="text-align: left;">Ticket</td><td class="highlight-yellow confluenceTd" colspan="1" data-highlight-colour="yellow" style="text-align: left;">version</td><td class="highlight-yellow confluenceTd" colspan="1" data-highlight-colour="yellow" style="text-align: left;">Number</td><td class="highlight-yellow confluenceTd" colspan="1" data-highlight-colour="yellow" style="text-align: left;">true</td><td class="highlight-yellow confluenceTd" colspan="1" data-highlight-colour="yellow" style="text-align: left;">tickets</td></tr><tr style="margin-left: 90.0px;"><td class="highlight-green confluenceTd" colspan="1" data-highlight-colour="green" style="text-align: left;">Order</td><td class="highlight-green confluenceTd" colspan="1" data-highlight-colour="green" style="text-align: left;">id</td><td class="highlight-green confluenceTd" colspan="1" data-highlight-colour="green" style="text-align: left;">String</td><td class="highlight-green confluenceTd" colspan="1" data-highlight-colour="green" style="text-align: left;">true</td><td class="highlight-green confluenceTd" colspan="1" data-highlight-colour="green" style="text-align: left;">orders</td></tr><tr style="margin-left: 90.0px;"><td class="highlight-green confluenceTd" colspan="1" data-highlight-colour="green" style="text-align: left;">Order</td><td class="highlight-green confluenceTd" colspan="1" data-highlight-colour="green" style="text-align: left;">userId</td><td class="highlight-green confluenceTd" colspan="1" data-highlight-colour="green" style="text-align: left;">String</td><td class="highlight-green confluenceTd" colspan="1" data-highlight-colour="green" style="text-align: left;">true</td><td class="highlight-green confluenceTd" colspan="1" data-highlight-colour="green" style="text-align: left;">orders</td></tr><tr style="margin-left: 90.0px;"><td class="highlight-green confluenceTd" colspan="1" data-highlight-colour="green" style="text-align: left;">Order</td><td class="highlight-green confluenceTd" colspan="1" data-highlight-colour="green" style="text-align: left;">status</td><td class="highlight-green confluenceTd" colspan="1" data-highlight-colour="green" style="text-align: left;">String</td><td class="highlight-green confluenceTd" colspan="1" data-highlight-colour="green" style="text-align: left;">true</td><td class="highlight-green confluenceTd" colspan="1" data-highlight-colour="green" style="text-align: left;">orders</td></tr><tr style="margin-left: 90.0px;"><td class="highlight-green confluenceTd" colspan="1" data-highlight-colour="green" style="text-align: left;">Order</td><td class="highlight-green confluenceTd" colspan="1" data-highlight-colour="green" style="text-align: left;">expiresAt</td><td class="highlight-green confluenceTd" colspan="1" data-highlight-colour="green" style="text-align: left;">Date</td><td class="highlight-green confluenceTd" colspan="1" data-highlight-colour="green" style="text-align: left;">true</td><td class="highlight-green confluenceTd" colspan="1" data-highlight-colour="green" style="text-align: left;">orders</td></tr><tr style="margin-left: 90.0px;"><td class="highlight-green confluenceTd" colspan="1" data-highlight-colour="green" style="text-align: left;">Order</td><td class="highlight-green confluenceTd" colspan="1" data-highlight-colour="green" style="text-align: left;">ticket</td><td class="highlight-green confluenceTd" colspan="1" data-highlight-colour="green" style="text-align: left;">Ref</td><td class="highlight-green confluenceTd" colspan="1" data-highlight-colour="green" style="text-align: left;">true</td><td class="highlight-green confluenceTd" colspan="1" data-highlight-colour="green" style="text-align: left;">orders</td></tr></tbody></table></div><p class="auto-cursor-target" style="margin-left: 30.0px;">The order service needs to know about the tickets that can be ordered if it is to be independent of the ticket service.</p><h2 class="auto-cursor-target" id="id-2)Datastoredineachservice-Notifyingotherservicesofdataupdates">Notifying other services of data updates</h2><p style="margin-left: 30.0px;">Any time you update any of the fields that other services might want to know about, you need to send a message to the event bus with the details of the update.</p><p style="margin-left: 30.0px;"><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="400" src="attachments/960542708/960543822.png" data-image-src="attachments/960542708/960543822.png" data-unresolved-comment-count="0" data-linked-resource-id="960543822" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image2020-9-7_12-16-6.png" data-base-url="https://confluence.tuigroup.com" data-linked-resource-content-type="image/png" data-linked-resource-container-id="960542708" data-linked-resource-container-version="4"></span></p><h2 id="id-2)Datastoredineachservice-ManagementInformation">Management Information</h2><p style="margin-left: 30.0px;">If the data is now spread out across all of your services, how do we get any Management Information out of the system?</p><p style="margin-left: 30.0px;">A common solution for this is to have a management information service, which looks at all data update events and stores the information into a central data lake or database.</p><p style="margin-left: 30.0px;">e.g. a simple solution:</p><p style="margin-left: 30.0px;"><br/></p><p style="margin-left: 30.0px;"><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" width="750" src="attachments/960542708/960543840.png" data-image-src="attachments/960542708/960543840.png" data-unresolved-comment-count="0" data-linked-resource-id="960543840" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image2020-9-7_12-27-3.png" data-base-url="https://confluence.tuigroup.com" data-linked-resource-content-type="image/png" data-linked-resource-container-id="960542708" data-linked-resource-container-version="4"></span></p><p><br/></p><p><br/></p><p style="margin-left: 30.0px;"><br/></p></div>
</div>
<div class="cell sidebars" data-type="sidebars">
<div class="innerCell">
<p><br/></p></div>
</div>
</div>
</div>
                    </div>

                                        <div class="pageSection group">
                        <div class="pageSectionHeader">
                            <h2 id="attachments" class="pageSectionTitle">Attachments:</h2>
                        </div>

                        <div class="greybox" align="left">
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/960542708/960543778.png">image2020-9-7_12-6-54.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/960542708/960543822.png">image2020-9-7_12-16-6.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/960542708/960543840.png">image2020-9-7_12-27-3.png</a> (image/png)
                                <br/>
                                                    </div>
                    </div>
                    
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on Oct 17, 2020 17:15</p>
                    <div id="footer-logo"><a href="http://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
